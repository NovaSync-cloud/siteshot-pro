<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>SiteShot Pro | Dashboard</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;600;700&display=swap" rel="stylesheet">
    <style>
        body { font-family: 'Inter', sans-serif; background-color: #0f172a; color: #f8fafc; }
        .sidebar { background: rgba(30, 41, 59, 0.5); backdrop-filter: blur(10px); border-right: 1px solid rgba(255,255,255,0.05); }
        .glass-card { background: rgba(30, 41, 59, 0.7); border: 1px solid rgba(255,255,255,0.1); border-radius: 1.5rem; }
        .gradient-text { background: linear-gradient(to right, #818cf8, #c084fc); -webkit-background-clip: text; color: transparent; }
        .custom-loader { width: 40px; height: 40px; border: 3px solid #6366f1; border-bottom-color: transparent; border-radius: 50%; display: inline-block; animation: rotation 1s linear infinite; }
        @keyframes rotation { 0% { transform: rotate(0deg) } 100% { transform: rotate(360deg) } }
    </style>
</head>
<body class="flex h-screen overflow-hidden">

    <!-- Sidebar -->
    <aside class="sidebar w-64 p-6 hidden md:flex flex-col">
        <div class="mb-10">
            <h1 class="text-2xl font-bold gradient-text italic">SiteShot Pro</h1>
        </div>
        <nav class="space-y-4 flex-1">
            <a href="#" class="flex items-center space-x-3 p-3 bg-indigo-600/20 text-indigo-400 rounded-xl border border-indigo-500/30">
                <span>‚ö°</span> <span class="font-semibold">Generator</span>
            </a>
            <a href="#gallery" class="flex items-center space-x-3 p-3 text-gray-400 hover:text-white transition">
                <span>üñºÔ∏è</span> <span>My Gallery</span>
            </a>
        </nav>
        <div class="pt-6 border-t border-white/5 text-xs text-gray-500">
            Render Free Tier: 512MB RAM
        </div>
    </aside>

    <!-- Main Content -->
    <main class="flex-1 overflow-y-auto p-4 md:p-10">
        <div class="max-w-5xl mx-auto">
            
            <!-- Header -->
            <header class="mb-10">
                <h2 class="text-3xl font-bold mb-2">Welcome back, Creator</h2>
                <p class="text-gray-400">Transform any link into professional marketing content.</p>
            </header>

            <!-- URL Input Area -->
            <section class="glass-card p-8 mb-10 shadow-2xl">
                <div class="flex flex-col md:flex-row gap-4">
                    <input id="urlInput" type="text" placeholder="Paste your website link here..." 
                           class="flex-1 bg-black/30 border border-white/10 p-4 rounded-xl focus:ring-2 ring-indigo-500 outline-none transition">
                    <button onclick="generate()" id="genBtn" 
                            class="bg-indigo-600 hover:bg-indigo-500 px-8 py-4 rounded-xl font-bold shadow-lg shadow-indigo-500/20 transition transform active:scale-95 disabled:opacity-50">
                        Generate
                    </button>
                </div>

                <!-- Loader -->
                <div id="loader" class="hidden mt-10 text-center">
                    <span class="custom-loader mb-4"></span>
                    <p id="status" class="text-indigo-400 font-medium">Starting AI Engine...</p>
                    <div class="w-full bg-white/5 h-1.5 mt-4 rounded-full max-w-sm mx-auto overflow-hidden">
                        <div id="bar" class="bg-indigo-500 h-full w-0 transition-all duration-700"></div>
                    </div>
                </div>
            </section>

            <!-- Active Result -->
            <section id="resultsSection" class="hidden mb-16 animate-in fade-in slide-in-from-bottom-4">
                <h3 class="text-xl font-bold mb-6 flex items-center gap-2">‚ú® New Assets Created</h3>
                <div id="resultsGrid" class="grid grid-cols-1 md:grid-cols-3 gap-6"></div>
            </section>

            <!-- Gallery (Local Memory) -->
            <section id="gallerySection" class="mt-10">
                <h3 class="text-xl font-bold mb-6 text-gray-300">Recent Projects</h3>
                <div id="historyGrid" class="grid grid-cols-2 md:grid-cols-4 gap-4 opacity-70">
                    <!-- History items will appear here -->
                </div>
            </section>

        </div>
    </main>

    <script>
        // Load history on start
        window.onload = loadHistory;

        function saveToHistory(data) {
            let history = JSON.parse(localStorage.getItem('ss_history') || '[]');
            history.unshift(data);
            if(history.length > 8) history.pop();
            localStorage.setItem('ss_history', JSON.stringify(history));
            loadHistory();
        }

        function loadHistory() {
            const history = JSON.parse(localStorage.getItem('ss_history') || '[]');
            const grid = document.getElementById('historyGrid');
            if(history.length === 0) {
                grid.innerHTML = '<p class="text-gray-600 col-span-4 py-10 text-center border-2 border-dashed border-white/5 rounded-2xl">No projects yet. Your work will appear here automatically.</p>';
                return;
            }
            grid.innerHTML = history.map(item => `
                <div class="glass-card p-2 rounded-xl text-xs">
                    <img src="data:image/jpeg;base64,${item.screenshot}" class="rounded-lg mb-2 h-24 w-full object-cover">
                    <p class="truncate opacity-50">${item.url}</p>
                </div>
            `).join('');
        }

        async function generate() {
            const url = document.getElementById('urlInput').value;
            if(!url) return alert("Please enter a URL!");

            const btn = document.getElementById('genBtn');
            const loader = document.getElementById('loader');
            const status = document.getElementById('status');
            const bar = document.getElementById('bar');
            
            btn.disabled = true;
            loader.classList.remove('hidden');
            
            // Step labels
            const steps = ["Connecting to API...", "Designing Collage...", "Rendering Video..."];
            let i = 0;
            const timer = setInterval(() => {
                if(i < 3) {
                    status.innerText = steps[i];
                    bar.style.width = (i + 1) * 33 + "%";
                    i++;
                }
            }, 5000);

            try {
                const res = await fetch('/api/generate', {
                    method: 'POST',
                    headers: {'Content-Type': 'application/json'},
                    body: JSON.stringify({ url })
                });
                
                const data = await res.json();
                if(!res.ok) throw new Error(data.error);

                saveToHistory({url, screenshot: data.screenshot});

                document.getElementById('resultsSection').classList.remove('hidden');
                document.getElementById('resultsGrid').innerHTML = `
                    <div class="glass-card p-4 overflow-hidden group">
                        <img src="data:image/jpeg;base64,${data.screenshot}" class="rounded-xl mb-4 w-full h-48 object-cover group-hover:scale-105 transition duration-500">
                        <a href="data:image/jpeg;base64,${data.screenshot}" download="shot.jpg" class="block w-full text-center py-2 bg-white/5 rounded-lg text-sm hover:bg-white/10 transition">Download Shot</a>
                    </div>
                    <div class="glass-card p-4 overflow-hidden group">
                        <img src="data:image/jpeg;base64,${data.collage}" class="rounded-xl mb-4 w-full h-48 object-cover group-hover:scale-105 transition duration-500">
                        <a href="data:image/jpeg;base64,${data.collage}" download="collage.jpg" class="block w-full text-center py-2 bg-white/5 rounded-lg text-sm hover:bg-white/10 transition">Download Design</a>
                    </div>
                    <div class="glass-card p-4 overflow-hidden group">
                        <video src="data:video/mp4;base64,${data.video}" controls class="rounded-xl mb-4 w-full h-48 object-cover"></video>
                        <a href="data:video/mp4;base64,${data.video}" download="promo.mp4" class="block w-full text-center py-2 bg-white/5 rounded-lg text-sm hover:bg-white/10 transition">Download Video</a>
                    </div>
                `;
            } catch (err) {
                alert("Error: " + err.message);
            } finally {
                clearInterval(timer);
                btn.disabled = false;
                loader.classList.add('hidden');
                bar.style.width = "0%";
            }
        }
    </script>
</body>
</html>
